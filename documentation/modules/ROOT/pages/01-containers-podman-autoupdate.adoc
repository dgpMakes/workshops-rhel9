[#podmanautoupdate]
=== Podman auto-update

In this section we are going to see how to automatically update the container image we have just deployed.

We need to manage the lifecycle application for the container image, so we will need to update the image according our needs.

When deploying multiple devices, for instance in Edge deployments, updating the containers is a challenge. Using **podman auto-update** we can automatically update them with only update the container image in the registry.

=== How we will implement the automatic updates

We will implement the automatic updates in the following way:

image::serverless/podman-autoupdate.png[]

1. A systemd timer will be used to periodically look for new versions for the container image in the registry.
2. If a new image is found in the registry podman will download it.
3. The running container image will be updated.

=== Creating the systemd timer

Using the **core** user create the timer:

[source,bash,subs="+macros,+attributes"]
[core@rhel9 ~]$ cat << EOF .config/systemd/user/podman-auto-update.timer 
[Unit]
Description=Podman auto-update timer
[Timer]
# This example runs the podman auto-update daily within a two-hour
# randomized window to reduce system load
#OnCalendar=daily
#Persistent=true
#RandomizedDelaySec=7200
# activate every minute
OnBootSec=30
OnUnitActiveSec=30
[Install]
WantedBy=timers.target
EOF
[core@rhel9 ~]$

Now we will create the unit that will be executed by the above timer:

[source,bash,subs="+macros,+attributes"]
[core@rhel9 ~]$ cat << EOF .config/systemd/user/podman-auto-update.service
[Unit]
Description=Podman auto-update service
Documentation=man:podman-auto-update(1)
[Service]
ExecStart=/usr/bin/podman auto-update
[Install]
WantedBy=multi-user.target default.target
EOF
[core@rhel9 ~]$

TIP: We can create an script to perform some more tasks if needed and configure the script within **[Service]** section in **ExecStart**.
